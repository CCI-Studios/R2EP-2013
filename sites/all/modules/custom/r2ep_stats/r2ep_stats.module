<?php
define('R2EP_BLOCK_NATIONAL', 'r2ep_national_stats');
define('R2EP_BLOCK_EVENT', 'r2ep_event_stats');
define('R2EP_BLOCK_TEAM', 'r2ep_team_stats');
define('R2EP_BLOCK_RUNNER', 'r2ep_runner_stats');

module_load_include('inc', 'r2ep_stats', 'r2ep_stats.queries');

function r2ep_stats_block_info() {
	$blocks = array();
	$blocks[R2EP_BLOCK_NATIONAL] = array(
		'info' => t('R2EP National Statistics'),
	);

	$blocks[R2EP_BLOCK_EVENT] = array(
		'info' => t('R2EP Event Statistics'),
	);

	$blocks[R2EP_BLOCK_TEAM] = array(
		'info' => t('R2EP Team Statistics'),
	);

	$block[R2EP_BLOCK_RUNNER] = array(
		'info' => t('R2EP Runner Statistics'),
	);

	return $blocks;
}

function r2ep_stats_block_view($delta = '') {
	// $path = drupal_get_path('module', 'r2ep_stats');
	// drupal_add_css($path .'/css/r2ep_stats.css');
	$block = array();

	switch ($delta) {
		case R2EP_BLOCK_NATIONAL:
			$block['subject'] = t('National Statistics');
			$block['content'] = _r2ep_stats_national_stats();
			break;
		case R2EP_BLOCK_EVENT:
			$block['subject'] = t('Event Statistics');
			$block['content'] = _r2ep_stats_event_stats();
			break;
		case R2EP_BLOCK_TEAM:
			$block['subject'] = t('Team Statistics');
			$block['content'] = _r2ep_stats_team_stats();
			break;
		case R2EP_BLOCK_RUNNER:
			$block['subject'] = t('Runner Statistics');
			$block['content'] = _r2ep_stats_runner_stats();
			break;
	}

	return $block;
}

function _r2ep_stats_national_stats() {
	$block = array();

	$runner_count = _r2ep_stats_get_runner_count('NATIONAL');
	$runners_label = $runner_count == 1 ? 'runner' : 'runners';

	$money = _r2ep_stats_get_donation_total('NATIONAL');

	$teams_count = _r2ep_stats_get_team_count('NATIONAL');
	$teams_label = $teams_count == 1 ? 'team' : 'teams';

	$block = _r2ep_stats_block(array(
		$runner_count .' '. t($runners_label),
		$money .' '. t('raised'),
		$teams_count .' '. t($teams_label)
	), array('runners', 'coin', 'teams'));

	return $block;
}

function _r2ep_stats_event_stats() {
	$block = array();
	$node = menu_get_object();

	if (!$node || $node->type != 'event') {
		return '';
	}

	$runners_count = _r2ep_stats_get_runner_count('EVENT', $node->nid);
	$runners_label = $runners_count == 1 ? 'runner' : 'runners';

	$money = _r2ep_stats_get_donation_total('EVENT', $node->nid);

	$teams = _r2ep_stats_get_teams('EVENT');
	$teams_count = count($teams);
	$teams_label = $teams_count == 1 ? 'team' : 'teams';

	$block = _r2ep_stats_block(array(
		$runners_count .' '. t($runners_label),
		$money .' '. t('raised'),
		$teams_count .' '. t($teams_label)
	), array('runners', 'coin', 'teams'));

	return $block;
}

function _r2ep_stats_team_stats() {
	// $block = array();
	// $node = menu_get_object();

	// if (!$node || $node->type != 'team') {
	// 	return '';
	// }

	// $runners_count = _r2ep_stats_get_runner_count('TEAM', $node);
	// $runners_label = $runners_count == 1 ? 'runner' : 'runners';

	// $money = _r2ep_stats_get_campaign_total($runners);

	// $teams = array(); //_r2ep_stats_get_teams('TEAM');
	// $teams_count = count($teams);
	// $teams_label = $teams_count == 1 ? 'team' : 'teams';

	// $block = _r2ep_stats_block(array(
	// 	$runners_count .' '. t($runners_label),
	// 	$money .' '. t('raised'),
	// 	$teams_count .' '. t($teams_label)
	// ), array('runners', 'coin', 'teams'));

	// return $block;
	return 'team';
}

function _r2ep_stats_runner_stats() {
	// $block = _r2ep_stats_national_stats();
	// return $block;
	return 'runner';
}


